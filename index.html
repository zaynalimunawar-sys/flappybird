<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flappy Bird - Shop Edition</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
    }

    #gameContainer {
      position: relative;
      width: 400px;
      height: 600px;
      overflow: hidden;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5), 0 0 100px rgba(255,255,255,0.1);
      border: 3px solid rgba(255,255,255,0.2);
    }

    #gameCanvas {
      display: block;
      width: 100%;
      height: 100%;
    }

    #startScreen, #gameOverScreen, #shopScreen, #codesScreen, #badgesScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
      backdrop-filter: blur(10px);
      z-index: 10;
    }

    #gameOverScreen, #shopScreen, #codesScreen, #badgesScreen {
      display: none;
    }

    .title {
      font-size: 56px;
      font-weight: bold;
      background: linear-gradient(45deg, #fff, #ffd700, #fff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 5px 15px rgba(0,0,0,0.3);
      margin-bottom: 20px;
      font-family: 'Comic Sans MS', cursive;
      animation: titleFloat 3s ease-in-out infinite;
      text-align: center;
      width: 100%;
      padding: 0 20px;
    }

    @keyframes titleFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .instruction {
      font-size: 20px;
      color: white;
      text-shadow: 0 3px 10px rgba(0,0,0,0.5);
      margin-bottom: 20px;
      text-align: center;
      width: 100%;
      padding: 0 20px;
    }

    .btn {
      background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
      border: none;
      padding: 15px 40px;
      font-size: 22px;
      font-weight: bold;
      color: #000;
      cursor: pointer;
      border-radius: 50px;
      transition: all 0.3s;
      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4), 0 5px 15px rgba(0,0,0,0.3);
      margin: 8px;
    }

    .btn:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 15px 40px rgba(255, 215, 0, 0.6), 0 10px 20px rgba(0,0,0,0.4);
    }

    .btn:active {
      transform: translateY(-2px) scale(1.02);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      color: white;
    }

    #score, #coins {
      position: absolute;
      top: 20px;
      font-size: 42px;
      font-weight: bold;
      color: white;
      text-shadow: 0 4px 8px rgba(0,0,0,0.5);
      z-index: 5;
      pointer-events: none;
    }

    #score {
      left: 20px;
    }

    #coins {
      right: 20px;
      color: #ffd700;
    }

    #streak {
      position: absolute;
      top: 70px;
      width: 100%;
      text-align: center;
      font-size: 32px;
      font-weight: bold;
      color: #ff6b6b;
      text-shadow: 0 0 10px rgba(255,107,107,0.8), 0 4px 8px rgba(0,0,0,0.5);
      z-index: 5;
      pointer-events: none;
      opacity: 0;
      animation: streakPulse 0.5s ease-in-out infinite;
    }

    @keyframes streakPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    #notification {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 48px;
      font-weight: bold;
      color: #ffd700;
      text-shadow: 0 0 20px rgba(255,215,0,1), 0 5px 15px rgba(0,0,0,0.8);
      z-index: 6;
      pointer-events: none;
      opacity: 0;
    }

    .finalScore {
      font-size: 28px;
      color: white;
      text-shadow: 0 3px 10px rgba(0,0,0,0.5);
      margin: 8px 0;
      background: rgba(255,255,255,0.1);
      padding: 10px 30px;
      border-radius: 20px;
      backdrop-filter: blur(5px);
      text-align: center;
    }

    .finalScore span {
      color: #ffd700;
      font-weight: bold;
    }

    .achievement {
      font-size: 20px;
      color: #4ade80;
      margin: 4px 0;
      animation: achievementPop 0.5s ease-out;
    }

    @keyframes achievementPop {
      0% { transform: scale(0); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    .shop-item {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 15px 25px;
      margin: 10px 0;
      width: 320px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 2px solid rgba(255,255,255,0.2);
      transition: all 0.3s;
    }

    .shop-item:hover {
      transform: scale(1.05);
      background: rgba(255,255,255,0.25);
    }

    .shop-item.admin-item {
      border: 3px solid rgba(255,0,0,0.5);
      background: rgba(255,0,0,0.1);
      animation: adminItemGlow 2s ease-in-out infinite;
    }

    @keyframes adminItemGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(255,0,0,0.4); }
      50% { box-shadow: 0 0 35px rgba(255,0,0,0.7); }
    }

    .shop-item-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .shop-item-icon {
      font-size: 40px;
    }

    .shop-item-details {
      text-align: left;
    }

    .shop-item-name {
      font-size: 22px;
      font-weight: bold;
      color: white;
      text-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }

    .shop-item-price {
      font-size: 18px;
      color: #ffd700;
      font-weight: bold;
    }

    .shop-btn {
      background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      cursor: pointer;
      border-radius: 25px;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(74, 222, 128, 0.4);
    }

    .shop-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 20px rgba(74, 222, 128, 0.6);
    }

    .shop-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
      opacity: 0.5;
    }

    .owned {
      background: #6c757d;
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      font-size: 14px;
      font-weight: bold;
    }

    .equipped {
      background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
      color: #000;
      padding: 10px 20px;
      border-radius: 25px;
      font-size: 14px;
      font-weight: bold;
    }

    .admin-badge {
      background: linear-gradient(135deg, #ff0000 0%, #ff6b6b 100%);
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      font-size: 14px;
      font-weight: bold;
      animation: adminGlow 2s ease-in-out infinite;
    }

    @keyframes adminGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(255,0,0,0.6); }
      50% { box-shadow: 0 0 30px rgba(255,0,0,1); }
    }

    .shop-header {
      font-size: 36px;
      color: #ffd700;
      margin-bottom: 20px;
      text-shadow: 0 3px 10px rgba(0,0,0,0.5);
    }

    .shop-coins {
      font-size: 32px;
      color: white;
      margin-bottom: 20px;
      text-shadow: 0 3px 10px rgba(0,0,0,0.5);
    }

    .shop-content {
      max-height: 350px;
      overflow-y: auto;
      padding: 10px;
    }

    .shop-content::-webkit-scrollbar {
      width: 8px;
    }

    .shop-content::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
    }

    .shop-content::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.3);
      border-radius: 10px;
    }

    .code-input-container {
      margin: 30px 0;
    }

    .code-input {
      background: rgba(255,255,255,0.2);
      border: 3px solid rgba(255,255,255,0.4);
      border-radius: 15px;
      padding: 15px 25px;
      font-size: 22px;
      color: white;
      text-align: center;
      width: 320px;
      font-weight: bold;
      transition: all 0.3s;
      backdrop-filter: blur(10px);
    }

    .code-input::placeholder {
      color: rgba(255,255,255,0.6);
    }

    .code-input:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 20px rgba(255,215,0,0.5);
    }

    .code-message {
      font-size: 20px;
      color: white;
      text-shadow: 0 3px 10px rgba(0,0,0,0.5);
      margin-top: 20px;
      min-height: 30px;
      font-weight: bold;
    }

    .code-success {
      color: #4ade80;
      animation: successPulse 0.5s ease-out;
    }

    .code-error {
      color: #ff6b6b;
      animation: errorShake 0.5s ease-out;
    }

    @keyframes successPulse {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes errorShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    .badge-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      max-height: 400px;
      overflow-y: auto;
      padding: 10px;
      width: 350px;
    }

    .badge-card {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      border: 2px solid rgba(255,255,255,0.2);
      text-align: center;
      transition: all 0.3s;
    }

    .badge-card:hover {
      transform: scale(1.05);
      background: rgba(255,255,255,0.25);
    }

    .badge-card.unlocked {
      border-color: #4ade80;
      box-shadow: 0 0 20px rgba(74, 222, 128, 0.4);
    }

    .badge-card.locked {
      opacity: 0.5;
      filter: grayscale(100%);
    }

    .badge-icon {
      font-size: 50px;
      margin-bottom: 10px;
    }

    .badge-name {
      font-size: 16px;
      font-weight: bold;
      color: white;
      margin-bottom: 5px;
    }

    .badge-desc {
      font-size: 12px;
      color: rgba(255,255,255,0.8);
    }

    .badge-status {
      margin-top: 8px;
      font-size: 14px;
      font-weight: bold;
    }

    .badge-status.unlocked {
      color: #4ade80;
    }

    .badge-status.locked {
      color: #ff6b6b;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    <div id="score">0</div>
    <div id="coins">ü™ô 0</div>
    <div id="streak"></div>
    <div id="notification"></div>

    <div id="startScreen">
      <div class="title">üê¶ Flappy Bird üê¶</div>
      <div class="instruction">
        ‚ú® CLICK or SPACE to Flap ‚ú®<br>
        ü™ô Collect Coins!<br>
        üî• Get Streaks!<br>
        üéØ Unlock Achievements!
      </div>
      <button class="btn" onclick="startGame()">START GAME</button>
      <button class="btn" onclick="openShop()">üè™ SHOP</button>
      <button class="btn" onclick="openCodes()">üîë CODES</button>
      <button class="btn" onclick="openBadges()">üèÜ BADGES</button>
    </div>

    <div id="gameOverScreen">
      <div class="title">Game Over!</div>
      <div class="finalScore">Score: <span id="finalScore">0</span></div>
      <div class="finalScore">Coins: <span id="finalCoins">0</span></div>
      <div class="finalScore">Total: <span id="totalCoins">0</span></div>
      <div class="finalScore">Best: <span id="bestScore">0</span></div>
      <div id="achievementsList"></div>
      <button class="btn" onclick="restartGame()">PLAY AGAIN</button>
      <button class="btn btn-secondary" onclick="toMainMenu()">MAIN MENU</button>
    </div>

    <div id="shopScreen">
      <div class="title">üè™ Shop üè™</div>
      <div class="shop-coins">Your Coins: <span id="shopTotalCoins">0</span> ü™ô</div>
      <div class="shop-content" id="shopItems"></div>
      <button class="btn btn-secondary" onclick="closeShop()" style="margin-top: 20px;">BACK</button>
    </div>

    <div id="codesScreen">
      <div class="title">üîë Codes üîë</div>
      <div class="instruction">Enter a secret code below:</div>
      <div class="code-input-container">
        <input type="text" id="codeInput" class="code-input" placeholder="Enter Code Here" maxlength="30">
      </div>
      <button class="btn" onclick="redeemCode()">REDEEM CODE</button>
      <div class="code-message" id="codeMessage"></div>
      <button class="btn btn-secondary" onclick="closeCodes()" style="margin-top: 20px;">BACK</button>
    </div>

    <div id="badgesScreen">
      <div class="title">üèÜ Badges üèÜ</div>
      <div class="badge-grid" id="badgeGrid"></div>
      <button class="btn btn-secondary" onclick="closeBadges()" style="margin-top: 20px;">BACK</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let gameStarted = false;
    let gameOver = false;
    let score = 0;
    let sessionCoins = 0;
    let totalCoins = parseInt(localStorage.getItem('totalCoins')) || 0;
    let bestScore = parseInt(localStorage.getItem('flappyBestScore')) || 0;
    let streak = 0;
    let maxStreak = 0;
    let totalGamesPlayed = parseInt(localStorage.getItem('totalGamesPlayed')) || 0;

    // Badges system
    const badges = [
      { id: 'first_game', name: 'First Flight', emoji: 'üê£', desc: 'Play your first game', requirement: () => totalGamesPlayed >= 1 },
      { id: 'score_10', name: 'Rookie', emoji: 'ü•â', desc: 'Score 10 points', requirement: () => bestScore >= 10 },
      { id: 'score_25', name: 'Pro', emoji: 'ü•à', desc: 'Score 25 points', requirement: () => bestScore >= 25 },
      { id: 'score_50', name: 'Expert', emoji: 'ü•á', desc: 'Score 50 points', requirement: () => bestScore >= 50 },
      { id: 'coins_100', name: 'Coin Collector', emoji: 'üí∞', desc: 'Collect 100 coins', requirement: () => totalCoins >= 100 },
      { id: 'coins_500', name: 'Rich', emoji: 'üíé', desc: 'Collect 500 coins', requirement: () => totalCoins >= 500 },
      { id: 'all_skins', name: 'Collector', emoji: 'üé®', desc: 'Buy all regular skins', requirement: () => ownedSkins.length >= 9 },
      { id: 'admin', name: 'Admin', emoji: 'üëë', desc: 'Unlock Admin Bird', requirement: () => ownedSkins.includes('adminduck') }
    ];

    let unlockedBadges = JSON.parse(localStorage.getItem('unlockedBadges')) || [];

    // Shop items
    const shopItems = [
      { id: 'yellow', name: 'Yellow Bird', emoji: 'üê§', price: 0, owned: true, faceForward: true, isAdmin: false },
      { id: 'red', name: 'Red Bird', emoji: 'üê¶', price: 50, owned: false, faceForward: true, isAdmin: false },
      { id: 'blue', name: 'Blue Bird', emoji: 'üê¶‚Äç‚¨õ', price: 100, owned: false, faceForward: true, isAdmin: false },
      { id: 'pink', name: 'Pink Bird', emoji: 'ü¶©', price: 150, owned: false, faceForward: true, isAdmin: false },
      { id: 'eagle', name: 'Eagle', emoji: 'ü¶Ö', price: 200, owned: false, faceForward: true, isAdmin: false },
      { id: 'parrot', name: 'Parrot', emoji: 'ü¶ú', price: 250, owned: false, faceForward: true, isAdmin: false },
      { id: 'owl', name: 'Owl', emoji: 'ü¶â', price: 300, owned: false, faceForward: false, isAdmin: false },
      { id: 'penguin', name: 'Penguin', emoji: 'üêß', price: 400, owned: false, faceForward: false, isAdmin: false },
      { id: 'swan', name: 'Swan', emoji: 'ü¶¢', price: 500, owned: false, faceForward: true, isAdmin: false },
      { id: 'adminduck', name: 'üëë ADMIN BIRD üëë', emoji: 'üëë', price: 99999, owned: false, faceForward: true, isAdmin: true }
    ];

    let ownedSkins = JSON.parse(localStorage.getItem('ownedSkins')) || ['yellow'];
    let equippedSkin = localStorage.getItem('equippedSkin') || 'yellow';
    let redeemedCodes = JSON.parse(localStorage.getItem('redeemedCodes')) || [];

    shopItems.forEach(item => {
      item.owned = ownedSkins.includes(item.id);
    });

    // Sound effects using Web Audio API
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();

      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      if (type === 'flap') {
        oscillator.frequency.value = 440;
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
      } else if (type === 'coin') {
        oscillator.frequency.value = 880;
        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.15);
      } else if (type === 'score') {
        oscillator.frequency.value = 660;
        gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.2);
      } else if (type === 'die') {
        // "GET OUT" style sound - dramatic descending tone
        oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(110, audioContext.currentTime + 0.5);
        gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.5);
      }
    }

    function checkBadges() {
      let newlyUnlocked = [];
      badges.forEach(badge => {
        if (!unlockedBadges.includes(badge.id) && badge.requirement()) {
          unlockedBadges.push(badge.id);
          newlyUnlocked.push(badge);
        }
      });

      if (newlyUnlocked.length > 0) {
        localStorage.setItem('unlockedBadges', JSON.stringify(unlockedBadges));
        newlyUnlocked.forEach(badge => {
          setTimeout(() => showNotification('üèÜ ' + badge.name), 500);
        });
      }
    }

    function openBadges() {
      document.getElementById('startScreen').style.display = 'none';
      document.getElementById('badgesScreen').style.display = 'flex';
      renderBadges();
    }

    function closeBadges() {
      document.getElementById('badgesScreen').style.display = 'none';
      document.getElementById('startScreen').style.display = 'flex';
    }

    function renderBadges() {
      const container = document.getElementById('badgeGrid');
      container.innerHTML = '';

      badges.forEach(badge => {
        const isUnlocked = unlockedBadges.includes(badge.id);

        const card = document.createElement('div');
        card.className = 'badge-card ' + (isUnlocked ? 'unlocked' : 'locked');

        const icon = document.createElement('div');
        icon.className = 'badge-icon';
        icon.textContent = badge.emoji;

        const name = document.createElement('div');
        name.className = 'badge-name';
        name.textContent = badge.name;

        const desc = document.createElement('div');
        desc.className = 'badge-desc';
        desc.textContent = badge.desc;

        const status = document.createElement('div');
        status.className = 'badge-status ' + (isUnlocked ? 'unlocked' : 'locked');
        status.textContent = isUnlocked ? '‚úì UNLOCKED' : 'üîí LOCKED';

        card.appendChild(icon);
        card.appendChild(name);
        card.appendChild(desc);
        card.appendChild(status);

        container.appendChild(card);
      });
    }

    const bird = {
      x: 80,
      y: 250,
      width: 40,
      height: 30,
      velocity: 0,
      gravity: 0.35,
      jumpStrength: -7,
      rotation: 0
    };

    const pipeWidth = 52;
    const pipeGap = 160;
    const pipeSpeed = 2;
    let pipes = [];
    let frameCount = 0;

    const groundHeight = 100;
    let groundX = 0;

    let clouds = [];
    for (let i = 0; i < 5; i++) {
      clouds.push({
        x: Math.random() * canvas.width,
        y: Math.random() * 300,
        width: 60 + Math.random() * 40,
        height: 30 + Math.random() * 20,
        speed: 0.2 + Math.random() * 0.3
      });
    }

    let particles = [];
    let coins = [];
    let achievements = [];

    class Particle {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.vx = (Math.random() - 0.5) * 3;
        this.vy = Math.random() * 2 + 1;
        this.life = 1;
        this.decay = 0.02;
        this.size = 3 + Math.random() * 3;
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.life -= this.decay;
      }

      draw() {
        ctx.globalAlpha = this.life;
        ctx.fillStyle = '#ffffff';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
      }
    }

    class Coin {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.size = 20;
        this.collected = false;
        this.rotation = 0;
      }

      update() {
        this.x -= pipeSpeed;
        this.rotation += 0.1;
      }

      draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);
        ctx.font = this.size + 'px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#ffd700';
        ctx.fillText('ü™ô', 0, 0);
        ctx.restore();
      }

      checkCollision(bird) {
        const dist = Math.hypot(this.x - (bird.x + bird.width/2), this.y - (bird.y + bird.height/2));
        return dist < this.size + bird.width/2;
      }
    }

    function openShop() {
      document.getElementById('startScreen').style.display = 'none';
      document.getElementById('shopScreen').style.display = 'flex';
      document.getElementById('shopTotalCoins').textContent = totalCoins;
      renderShop();
    }

    function closeShop() {
      document.getElementById('shopScreen').style.display = 'none';
      document.getElementById('startScreen').style.display = 'flex';
    }

    function openCodes() {
      document.getElementById('startScreen').style.display = 'none';
      document.getElementById('codesScreen').style.display = 'flex';
      document.getElementById('codeInput').value = '';
      document.getElementById('codeMessage').textContent = '';
      document.getElementById('codeMessage').className = 'code-message';
    }

    function closeCodes() {
      document.getElementById('codesScreen').style.display = 'none';
      document.getElementById('startScreen').style.display = 'flex';
    }

    function redeemCode() {
      const input = document.getElementById('codeInput');
      const code = input.value.trim();
      const messageEl = document.getElementById('codeMessage');

      if (!code) {
        messageEl.textContent = '‚ùå Please enter a code!';
        messageEl.className = 'code-message code-error';
        return;
      }

      if (redeemedCodes.includes(code.toLowerCase())) {
        messageEl.textContent = '‚ùå Code already redeemed!';
        messageEl.className = 'code-message code-error';
        return;
      }

      if (code.toLowerCase() === 'zaynthebest') {
        const adminBird = shopItems.find(s => s.id === 'adminduck');
        if (!adminBird.owned) {
          adminBird.owned = true;
          ownedSkins.push('adminduck');
          localStorage.setItem('ownedSkins', JSON.stringify(ownedSkins));
          redeemedCodes.push(code.toLowerCase());
          localStorage.setItem('redeemedCodes', JSON.stringify(redeemedCodes));

          messageEl.textContent = '‚úÖ ADMIN BIRD UNLOCKED! üëë';
          messageEl.className = 'code-message code-success';

          showNotification('üëë ADMIN BIRD!');
          checkBadges();

          input.value = '';
        } else {
          messageEl.textContent = '‚ö†Ô∏è You already have Admin Bird!';
          messageEl.className = 'code-message';
        }
      } else if (code.toLowerCase() === 'adminonly') {
        shopItems.forEach(item => {
          item.owned = true;
          if (!ownedSkins.includes(item.id)) {
            ownedSkins.push(item.id);
          }
        });
        totalCoins += 99999;
        bestScore = 99999;
        localStorage.setItem('ownedSkins', JSON.stringify(ownedSkins));
        localStorage.setItem('totalCoins', totalCoins);
        localStorage.setItem('flappyBestScore', bestScore);
        redeemedCodes.push(code.toLowerCase());
        localStorage.setItem('redeemedCodes', JSON.stringify(redeemedCodes));
        messageEl.textContent = 'üî• GOD MODE ACTIVATED! ALL UNLOCKED + 99999 COINS + 99999 SCORE! üî•';
        messageEl.className = 'code-message code-success';
        showNotification('‚ö° ADMIN ONLY! ‚ö°');
        checkBadges();
        input.value = '';
      } else {
        messageEl.textContent = '‚ùå Invalid code!';
        messageEl.className = 'code-message code-error';
      }
    }

    document.addEventListener('keypress', function(e) {
      if (e.key === 'Enter' && document.getElementById('codesScreen').style.display === 'flex') {
        redeemCode();
      }
    });

    function toMainMenu() {
      document.getElementById('gameOverScreen').style.display = 'none';
      document.getElementById('startScreen').style.display = 'flex';
    }

    function renderShop() {
      const container = document.getElementById('shopItems');
      container.innerHTML = '';

      shopItems.forEach(item => {
        if (item.isAdmin && !item.owned) return;

        const div = document.createElement('div');
        div.className = item.isAdmin ? 'shop-item admin-item' : 'shop-item';

        const info = document.createElement('div');
        info.className = 'shop-item-info';

        const icon = document.createElement('div');
        icon.className = 'shop-item-icon';
        icon.textContent = item.emoji;

        const details = document.createElement('div');
        details.className = 'shop-item-details';

        const name = document.createElement('div');
        name.className = 'shop-item-name';
        name.textContent = item.name;

        const price = document.createElement('div');
        price.className = 'shop-item-price';
        price.textContent = item.price + ' ü™ô';

        details.appendChild(name);
        if (!item.owned && !item.isAdmin) {
          details.appendChild(price);
        }

        info.appendChild(icon);
        info.appendChild(details);
        div.appendChild(info);

        if (item.id === equippedSkin) {
          const equipped = document.createElement('div');
          equipped.className = item.isAdmin ? 'admin-badge' : 'equipped';
          equipped.textContent = item.isAdmin ? 'üëë ADMIN' : 'EQUIPPED';
          div.appendChild(equipped);
        } else if (item.owned) {
          const equipBtn = document.createElement('button');
          equipBtn.className = 'shop-btn';
          equipBtn.textContent = 'EQUIP';
          equipBtn.onclick = () => equipSkin(item.id);
          div.appendChild(equipBtn);
        } else {
          const buyBtn = document.createElement('button');
          buyBtn.className = 'shop-btn';
          buyBtn.textContent = 'BUY';
          buyBtn.disabled = totalCoins < item.price;
          buyBtn.onclick = () => buySkin(item.id);
          div.appendChild(buyBtn);
        }

        container.appendChild(div);
      });
    }

    function buySkin(id) {
      const item = shopItems.find(i => i.id === id);
      if (totalCoins >= item.price) {
        totalCoins -= item.price;
        item.owned = true;
        ownedSkins.push(id);
        localStorage.setItem('totalCoins', totalCoins);
        localStorage.setItem('ownedSkins', JSON.stringify(ownedSkins));
        document.getElementById('shopTotalCoins').textContent = totalCoins;
        renderShop();
        showNotification('‚úÖ Purchased!');
        checkBadges();
      }
    }

    function equipSkin(id) {
      equippedSkin = id;
      localStorage.setItem('equippedSkin', equippedSkin);
      renderShop();
      const item = shopItems.find(s => s.id === id);
      showNotification(item.isAdmin ? 'üëë ADMIN MODE!' : '‚ú® Equipped!');
    }

    function startGame() {
      document.getElementById('startScreen').style.display = 'none';
      gameStarted = true;
      gameOver = false;
      score = 0;
      sessionCoins = 0;
      streak = 0;
      maxStreak = 0;
      bird.y = 250;
      bird.velocity = 0;
      bird.rotation = 0;
      pipes = [];
      particles = [];
      coins = [];
      achievements = [];
      frameCount = 0;
      document.getElementById('score').textContent = '0';
      document.getElementById('coins').textContent = 'ü™ô 0';
      document.getElementById('streak').style.opacity = '0';

      totalGamesPlayed++;
      localStorage.setItem('totalGamesPlayed', totalGamesPlayed);
      checkBadges();

      gameLoop();
    }

    function restartGame() {
      document.getElementById('gameOverScreen').style.display = 'none';
      startGame();
    }

    function flap() {
      if (!gameStarted || gameOver) return;
      bird.velocity = bird.jumpStrength;
      bird.rotation = -25;

      playSound('flap');

      for (let i = 0; i < 6; i++) {
        particles.push(new Particle(bird.x, bird.y + bird.height / 2));
      }
    }

    canvas.addEventListener('mousedown', function(e) {
      e.preventDefault();
      flap();
    });

    let spacePressed = false;
    document.addEventListener('keydown', function(e) {
      if (e.code === 'Space' && !spacePressed) {
        e.preventDefault();
        spacePressed = true;
        flap();
      }
    });

    document.addEventListener('keyup', function(e) {
      if (e.code === 'Space') {
        spacePressed = false;
      }
    });

    function createPipe() {
      const minHeight = 80;
      const maxHeight = canvas.height - groundHeight - pipeGap - 80;
      const topHeight = Math.floor(Math.random() * (maxHeight - minHeight + 1)) + minHeight;

      pipes.push({
        x: canvas.width,
        topHeight: topHeight,
        bottomY: topHeight + pipeGap,
        passed: false,
        highlight: false,
        coinSpawned: false
      });
    }

    function spawnCoin(pipe) {
      if (!pipe.coinSpawned && Math.random() < 0.7) {
        const coinY = pipe.topHeight + pipeGap / 2;
        coins.push(new Coin(pipe.x + pipeWidth / 2, coinY));
        pipe.coinSpawned = true;
      }
    }

    function showNotification(text) {
      const el = document.getElementById('notification');
      el.textContent = text;
      el.style.opacity = '1';
      el.style.transform = 'translate(-50%, -50%) scale(1)';

      setTimeout(() => {
        el.style.transition = 'all 0.5s';
        el.style.opacity = '0';
        el.style.transform = 'translate(-50%, -50%) scale(1.5)';
      }, 800);
    }

    function checkAchievements() {
      const newAchievements = [];

      if (score >= 10 && !achievements.includes('First 10!')) {
        achievements.push('First 10!');
        newAchievements.push('üéØ First 10!');
      }
      if (score >= 25 && !achievements.includes('Quarter Century!')) {
        achievements.push('Quarter Century!');
        newAchievements.push('üåü Quarter Century!');
      }
      if (score >= 50 && !achievements.includes('Halfway to 100!')) {
        achievements.push('Halfway to 100!');
        newAchievements.push('üî• Halfway to 100!');
      }
      if (sessionCoins >= 20 && !achievements.includes('Coin Collector!')) {
        achievements.push('Coin Collector!');
        newAchievements.push('ü™ô Coin Collector!');
      }
      if (streak >= 5 && !achievements.includes('Streak Master!')) {
        achievements.push('Streak Master!');
        newAchievements.push('‚≠ê Streak Master!');
      }

      return newAchievements;
    }

    function update() {
      if (gameOver) return;

      frameCount++;

      if (frameCount % 120 === 0) {
        createPipe();
      }

      bird.velocity += bird.gravity;
      bird.y += bird.velocity;

      if (bird.velocity < 0) {
        bird.rotation = Math.max(-25, bird.rotation - 2);
      } else {
        bird.rotation = Math.min(90, bird.rotation + 2.5);
      }

      pipes.forEach((pipe, index) => {
        pipe.x -= pipeSpeed;

        if (!pipe.coinSpawned && pipe.x < canvas.width - 100) {
          spawnCoin(pipe);
        }

        if (bird.x > pipe.x && bird.x < pipe.x + pipeWidth) {
          pipe.highlight = true;
        }

        if (!pipe.passed && pipe.x + pipeWidth < bird.x) {
          pipe.passed = true;
          score++;
          streak++;
          maxStreak = Math.max(maxStreak, streak);
          document.getElementById('score').textContent = score;

          playSound('score');

          if (streak >= 3) {
            document.getElementById('streak').textContent = 'üî• STREAK x' + streak + '!';
            document.getElementById('streak').style.opacity = '1';
          }

          const newAchievements = checkAchievements();
          if (newAchievements.length > 0) {
            showNotification(newAchievements[0]);
          }
        }

        if (pipe.x + pipeWidth < 0) {
          pipes.splice(index, 1);
        }
      });

      coins.forEach((coin, index) => {
        coin.update();

        if (!coin.collected && coin.checkCollision(bird)) {
          coin.collected = true;
          sessionCoins++;
          totalCoins++;
          document.getElementById('coins').textContent = 'ü™ô ' + sessionCoins;
          localStorage.setItem('totalCoins', totalCoins);
          showNotification('+1 ü™ô');
          playSound('coin');
          checkBadges();
          coins.splice(index, 1);
        }

        if (coin.x < -50) {
          coins.splice(index, 1);
        }
      });

      clouds.forEach(cloud => {
        cloud.x -= cloud.speed;
        if (cloud.x + cloud.width < 0) {
          cloud.x = canvas.width + 20;
          cloud.y = Math.random() * 300;
        }
      });

      particles.forEach((particle, index) => {
        particle.update();
        if (particle.life <= 0) {
          particles.splice(index, 1);
        }
      });

      groundX -= pipeSpeed;
      if (groundX <= -30) groundX = 0;

      checkCollisions();
    }

    function checkCollisions() {
      if (bird.y + bird.height >= canvas.height - groundHeight || bird.y <= 0) {
        endGame();
      }

      const hitboxReduction = 4;
      pipes.forEach(pipe => {
        if (bird.x + bird.width - hitboxReduction > pipe.x && 
            bird.x + hitboxReduction < pipe.x + pipeWidth) {
          if (bird.y + hitboxReduction < pipe.topHeight || 
              bird.y + bird.height - hitboxReduction > pipe.bottomY) {
            endGame();
          }
        }
      });
    }

    function endGame() {
      if (gameOver) return;
      gameOver = true;
      streak = 0;
      document.getElementById('streak').style.opacity = '0';

      playSound('die');

      if (score > bestScore) {
        bestScore = score;
        localStorage.setItem('flappyBestScore', bestScore);
      }

      checkBadges();

      document.getElementById('finalScore').textContent = score;
      document.getElementById('finalCoins').textContent = sessionCoins;
      document.getElementById('totalCoins').textContent = totalCoins;
      document.getElementById('bestScore').textContent = bestScore;

      const achievementsList = document.getElementById('achievementsList');
      achievementsList.innerHTML = '';
      achievements.forEach(ach => {
        const div = document.createElement('div');
        div.className = 'achievement';
        div.textContent = '‚ú® ' + ach;
        achievementsList.appendChild(div);
      });

      document.getElementById('gameOverScreen').style.display = 'flex';
    }

    function getCurrentSkin() {
      return shopItems.find(s => s.id === equippedSkin);
    }

    function shouldFaceForward() {
      const skin = getCurrentSkin();
      return skin ? skin.faceForward : true;
    }

    function draw() {
      const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height - groundHeight);
      skyGradient.addColorStop(0, '#87CEEB');
      skyGradient.addColorStop(0.5, '#98D8E8');
      skyGradient.addColorStop(1, '#B0E0E6');
      ctx.fillStyle = skyGradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height - groundHeight);

      clouds.forEach(cloud => {
        ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
        ctx.beginPath();
        ctx.ellipse(cloud.x, cloud.y, cloud.width / 2, cloud.height / 2, 0, 0, Math.PI * 2);
        ctx.ellipse(cloud.x + cloud.width * 0.3, cloud.y - cloud.height * 0.3, cloud.width / 2.5, cloud.height / 2.5, 0, 0, Math.PI * 2);
        ctx.ellipse(cloud.x - cloud.width * 0.3, cloud.y - cloud.height * 0.2, cloud.width / 3, cloud.height / 3, 0, 0, Math.PI * 2);
        ctx.fill();
      });

      pipes.forEach(pipe => {
        const pipeColor = pipe.highlight ? '#4a9b4a' : '#5cb85c';

        const topPipeGradient = ctx.createLinearGradient(pipe.x, 0, pipe.x + pipeWidth, 0);
        topPipeGradient.addColorStop(0, pipeColor);
        topPipeGradient.addColorStop(0.5, '#6fd16f');
        topPipeGradient.addColorStop(1, '#4a9b4a');
        ctx.fillStyle = topPipeGradient;
        ctx.fillRect(pipe.x, 0, pipeWidth, pipe.topHeight);

        ctx.fillStyle = '#6fd16f';
        ctx.fillRect(pipe.x - 3, pipe.topHeight - 25, pipeWidth + 6, 25);

        ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
        ctx.fillRect(pipe.x + 5, 0, 8, pipe.topHeight);

        ctx.fillStyle = topPipeGradient;
        ctx.fillRect(pipe.x, pipe.bottomY, pipeWidth, canvas.height - groundHeight - pipe.bottomY);

        ctx.fillStyle = '#6fd16f';
        ctx.fillRect(pipe.x - 3, pipe.bottomY, pipeWidth + 6, 25);

        ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
        ctx.fillRect(pipe.x + 5, pipe.bottomY, 8, canvas.height - groundHeight - pipe.bottomY);
      });

      const groundGradient = ctx.createLinearGradient(0, canvas.height - groundHeight, 0, canvas.height);
      groundGradient.addColorStop(0, '#8B7355');
      groundGradient.addColorStop(0.3, '#A0826D');
      groundGradient.addColorStop(1, '#6F5645');
      ctx.fillStyle = groundGradient;
      ctx.fillRect(0, canvas.height - groundHeight, canvas.width, groundHeight);

      ctx.fillStyle = '#5A7C42';
      for (let i = 0; i < canvas.width + 30; i += 30) {
        ctx.fillRect(i + groundX, canvas.height - groundHeight, 15, 5);
      }

      ctx.fillStyle = '#FF6B9D';
      for (let i = 0; i < canvas.width + 40; i += 40) {
        ctx.beginPath();
        ctx.arc(i + groundX + 7, canvas.height - groundHeight + 10, 2, 0, Math.PI * 2);
        ctx.fill();
      }

      coins.forEach(coin => coin.draw());
      particles.forEach(particle => particle.draw());

      ctx.save();

      ctx.globalAlpha = 0.3;
      ctx.fillStyle = '#000';
      ctx.beginPath();
      ctx.ellipse(bird.x + bird.width / 2, canvas.height - groundHeight - 5, bird.width / 2, 5, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.globalAlpha = 1;

      const skin = getCurrentSkin();

      if (skin && skin.isAdmin) {
        ctx.shadowBlur = 25;
        ctx.shadowColor = '#ffd700';
      }

      ctx.translate(bird.x + bird.width / 2, bird.y + bird.height / 2);

      if (shouldFaceForward()) {
        ctx.rotate((bird.rotation * Math.PI) / 180);
      }

      ctx.font = '50px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(skin ? skin.emoji : 'üê§', 0, 0);

      ctx.restore();
    }

    function gameLoop() {
      if (!gameStarted) return;

      update();
      draw();

      if (!gameOver) {
        requestAnimationFrame(gameLoop);
      }
    }

    draw();
  </script>
</body>
</html>
